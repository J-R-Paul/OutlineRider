/* --- General & Layout --- */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background-color: #f8f9fa;
    font-size: 16px;
    overscroll-behavior: none; /* Prevent pull-to-refresh interfering with drag */
}

header {
    padding: 8px 15px;
    background-color: #e9ecef;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex-shrink: 0; /* Prevent header shrinking */
}

.header-main {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

header h1 {
    margin: 0;
    font-size: 1.3em;
    font-weight: 600;
    white-space: nowrap;
    color: #343a40;
}

#currentFileName {
    font-style: italic;
    font-size: 0.9em;
    color: #6c757d;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 250px;
    text-align: right;
    margin-left: 10px; /* Space from title */
}
#currentFileName.dirty::after {
    content: '*';
    color: #dc3545; /* Red asterisk for dirty */
    margin-left: 2px;
    font-weight: bold;
}


.file-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
}

.action-group {
    display: flex;
    flex-wrap: nowrap;
    gap: 6px;
    align-items: center;
    padding: 2px 0; /* Tighter padding */
}

/* Label as button */
.file-input-label {
    padding: 5px 10px; cursor: pointer; border: 1px solid #ced4da; background-color: #f8f9fa;
    border-radius: 4px; font-size: 0.9em; color: #495057; transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out;
    display: inline-block; line-height: 1.5;
}
.file-input-label:hover { background-color: #e9ecef; border-color: #adb5bd; }
#fileInput { display: none; }

/* Header buttons */
header button {
    padding: 5px 10px; cursor: pointer; border: 1px solid #ced4da; background-color: #f8f9fa;
    border-radius: 4px; font-size: 0.9em; color: #495057; transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out;
}
header button:hover { background-color: #e9ecef; border-color: #adb5bd; }
header button:disabled { cursor: not-allowed; opacity: 0.65; background-color: #e9ecef; }

/* Toolbar */
#toolbar {
    padding: 6px 15px; background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; display: flex;
    gap: 5px; flex-wrap: wrap; align-items: center; flex-shrink: 0;
}
#toolbar button {
    padding: 4px 8px; cursor: pointer; border: 1px solid transparent; background-color: transparent;
    border-radius: 4px; font-size: 1em; color: #495057; min-width: 30px; text-align: center; line-height: 1.4;
}
#toolbar button:hover { background-color: #e9ecef; border-color: #ced4da; }
#toolbar hr { border: none; border-left: 1px solid #dee2e6; height: 18px; margin: 0 3px; }
#toolbar button b, #toolbar button i { font-size: 1.1em; }
#toolbar button[data-type="heading"] { font-weight: bold; }
#toolbar button[data-type="hr"] { color: #adb5bd; }

/* Main Editor Area */
main#outlineContainer {
    flex-grow: 1; padding: 15px; overflow-y: auto; outline: none; background-color: #fff;
    line-height: 1.6; color: #212529;
}
/* Remove blue highlight on tap on mobile */
main#outlineContainer * {
     -webkit-tap-highlight-color: transparent;
}


#initialMessage { /* (Keep existing styles) */
    padding: 20px; background-color: #f1f3f5; border-radius: 5px; margin-bottom: 20px;
    font-size: 0.95em; color: #495057; border: 1px solid #e9ecef;
}
#initialMessage ul { list-style: none; padding-left: 0; margin-top: 10px; }
#initialMessage li { margin-bottom: 8px; padding-left: 0; }
#initialMessage li::before { content: none; }
#initialMessage b { color: #343a40; }
.task-example { font-family: monospace; background: #e9ecef; padding: 1px 4px; border-radius: 3px;}

/* --- Outline Items --- */
#outlineContainer ul { list-style: none; padding-left: 24px; margin: 0; }
#outlineContainer ul ul { padding-left: 24px; }

#outlineContainer li {
    margin: 2px 0; position: relative;
    /* Make LI the drag handle */
    /* cursor: grab; */ /* Add this via JS during drag setup */
}
/* Indentation Guides (Optional) */
/*
#outlineContainer ul { border-left: 1px solid #e9ecef; }
#outlineContainer li { margin-left: -1px; border-left: 1px solid transparent; }
*/

/* Folding Triangle */
.fold-triangle {
    position: absolute;
    left: -18px; /* Adjust based on padding-left of ul */
    top: 0.4em; /* Vertically align roughly */
    cursor: pointer;
    font-size: 0.8em;
    color: #adb5bd;
    padding: 2px; /* Make tap target larger */
    user-select: none;
    width: 12px; /* Ensure consistent width */
    text-align: center;
    transition: transform 0.1s ease-in-out;
}
.fold-triangle.folded {
    transform: rotate(-90deg);
}
.fold-triangle.empty { /* Hide triangle if no children */
    opacity: 0;
    pointer-events: none;
}


#outlineContainer li > p {
    margin: 0; padding: 2px 5px; min-height: 1.6em; outline: none;
    border: 1px solid transparent; white-space: pre-wrap; word-wrap: break-word; border-radius: 3px;
    position: relative;
    /* Ensure paragraph takes up available space horizontally */
    display: block; /* Or flex if needed, but block is usually fine */
    /* Optional: Add padding left to avoid overlapping fold triangle text visually if needed */
    /* padding-left: 20px; If triangle is absolutely positioned within LI */
}
#outlineContainer li > p:focus { border: 1px dashed #adb5bd; background-color: #f8f9fa; }

/* --- Item Type Styling (Keep existing, including Task styling) --- */
/* ... (heading, note, task, ordered, unordered, hr styles remain mostly the same) ... */
#outlineContainer li[data-type="task"] > p { display: flex; align-items: baseline; }
span.task-checkbox { margin-right: 0.5em; cursor: pointer; font-family: monospace; user-select: none; display: inline-block; color: #6c757d; }
#outlineContainer li[data-type="task"][data-done="true"] > p { text-decoration: line-through; color: #adb5bd; }
#outlineContainer li[data-type="task"][data-done="true"] > p span.task-checkbox { color: #6c757d; }
/* Adjust bullet positions if fold triangle is present */
#outlineContainer li[data-type="unordered"]::before { left: -15px; /* Adjust as needed */ }

/* --- Formatting (Keep existing) --- */
/* ... (mark, code, a styles remain the same) ... */

/* --- Selection Highlight (Keep existing) --- */
#outlineContainer li.selected > p { background-color: #cfe2ff; border-color: #9ec5fe; }
#outlineContainer li[data-type="hr"].selected { outline: 2px solid #9ec5fe; outline-offset: 2px; }

/* --- Folding --- */
#outlineContainer li[data-folded="true"] > ul {
    display: none;
}

/* --- Drag and Drop Styling --- */
#outlineContainer li.dragging {
    opacity: 0.4;
    background: #f0f0f0;
}
#outlineContainer li p.drag-over-top::before,
#outlineContainer li p.drag-over-bottom::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    background-color: #0d6efd; /* Blue indicator line */
    z-index: 10;
}
#outlineContainer li p.drag-over-top::before { top: -1px; }
#outlineContainer li p.drag-over-bottom::after { bottom: -1px; }
#outlineContainer li p.drag-over-indent { /* Style for dropping inside */
     background-color: #cfe2ff; /* Light blue background */
     box-shadow: inset 2px 0 0 #0d6efd; /* Inset blue line */
}


/* --- KaTeX Specific Styling --- */
.katex-display {
    overflow-x: auto; /* Allow scrolling for wide equations */
    overflow-y: hidden;
    padding: 0.5em 0; /* Add some vertical space around display math */
}


/* --- Mobile Responsiveness (Keep existing, adjust maybe) --- */
@media (max-width: 768px) {
    header { padding: 8px 10px; }
    .header-main { flex-direction: column; align-items: flex-start; gap: 4px; margin-bottom: 5px; }
    header h1 { font-size: 1.2em; }
     #currentFileName { max-width: 100%; text-align: left; font-size: 0.85em; }
    .file-actions { gap: 5px; } .action-group { gap: 4px; }
    header button, .file-input-label { padding: 4px 8px; font-size: 0.85em; }
    #toolbar { padding: 5px 10px; }
    #toolbar button { padding: 3px 6px; min-width: 28px; font-size: 0.95em; }
    #toolbar hr { margin: 0 2px; }
     #outlineContainer ul { padding-left: 22px; } /* Adjust for fold icon */
     #outlineContainer ul ul { padding-left: 22px; }
     .fold-triangle { left: -19px; } /* Position fold icon */
     #outlineContainer li[data-type="unordered"]::before { left: -14px; } /* Adjust bullet */
     main#outlineContainer { padding: 10px; line-height: 1.55; }
     #outlineContainer li > p { padding: 1px 4px; min-height: 1.55em; }
}
@media (max-width: 480px) {
     header h1 { font-size: 1.1em; }
     header button, .file-input-label { font-size: 0.8em; padding: 3px 6px; }
     #toolbar button { font-size: 0.9em; min-width: 26px; padding: 2px 5px;}
     #outlineContainer ul { padding-left: 20px; }
     #outlineContainer ul ul { padding-left: 20px; }
     .fold-triangle { left: -18px; font-size: 0.75em; }
     #outlineContainer li[data-type="unordered"]::before { left: -13px; }
}