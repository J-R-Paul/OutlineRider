<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bike File Editor (Web)</title> <!-- Slightly different title -->
    <link rel="stylesheet" href="style.css">
    <!-- Add basic PWA manifest link and icons if desired for homescreen saving -->
    <!-- <link rel="manifest" href="manifest.json"> -->
    <!-- <link rel="apple-touch-icon" href="icons/icon-192x192.png"> -->
</head>
<body>
    <header>
        <h1>Bike File Editor (Web)</h1>
        <!-- File Handling Options -->
        <div>
            <label for="fileInput">Load (Copy from Device):</label>
            <input type="file" id="fileInput"
                   accept=".bike,.html,application/xhtml+xml,text/xml,application/xml"
                   aria-label="Load Bike File (Creates Copy)">
        </div>
        <!-- OPFS Buttons - Shown only if API is supported -->
        <div id="opfsFileAccess" style="display: none;">
             <button id="manageOpfsButton" title="Open or manage files saved within this app's storage">Manage App Files</button>
             <span id="currentFileName">No file open</span>
             <button id="saveToOpfsButton" disabled title="Save changes to the file currently open in app storage">Save to App Storage</button>
        </div>
        <!-- Standard Download Button -->
        <button id="saveAsButton" title="Download the current content as a .bike file">Save As / Download</button>
        <button id="clearLocalButton" title="Clear the temporary draft saved in your browser storage">Clear Temp Draft</button>

    </header>

    <div id="toolbar">
        <!-- Formatting Buttons -->
        <button class="format-button" data-command="bold" title="Bold (Ctrl+B)"><b>B</b></button>
        <button class="format-button" data-command="italic" title="Italic (Ctrl+I)"><i>I</i></button>
        <button class="format-button" data-command="code" title="Code">{}</button>
        <button class="format-button" data-command="highlight" title="Highlight">H</button>
        <button id="linkButton" title="Create Link">Link</button>
        <hr>
        <!-- Item Type Buttons -->
        <button class="type-button" data-type="heading" title="Heading">Heading</button>
        <button class="type-button" data-type="note" title="Note">Note</button>
        <button class="type-button" data-type="task" title="Task">Task</button>
        <button class="type-button" data-type="ordered" title="Ordered List Item">Ordered</button>
        <button class="type-button" data-type="unordered" title="Unordered List Item">Unordered</button>
        <button class="type-button" data-type="hr" title="Horizontal Rule">HR</button>
        <button class="type-button" data-type="" title="Plain Text">Plain</button> <!-- Empty data-type for default -->
        <hr>
        <!-- Outline Operation Buttons -->
        <button id="indentButton" title="Indent (Tab)">Indent</button>
        <button id="outdentButton" title="Outdent (Shift+Tab)">Outdent</button>
        <button id="moveUpButton" title="Move Up (Alt+Shift+Up)">Move Up</button>
        <button id="moveDownButton" title="Move Down (Alt+Shift+Down)">Move Down</button>
        <button id="deleteButton" title="Delete Item (Del/Backspace on empty)">Delete</button>
    </div>

    <main id="outlineContainer" tabindex="0"> <!-- Add tabindex to make container focusable -->
        <!-- Initial Instructions -->
        <div id="initialMessage">
            <p>Welcome! Choose an option:</p>
            <ul>
                <li><b>Load (Copy from Device):</b> Open a .bike or .html file from your computer/phone. Changes are not saved back automatically. Use "Save As / Download" to get a copy.</li>
                <li id="opfsInfo" style="display: none;"><b>Manage App Files:</b> Open, create, or delete files stored privately by this web app in your browser (ideal for Safari/iOS).</li>
                <li><b>Save As / Download:</b> Download the current outline as a file.</li>
                <li><b>Clear Temp Draft:</b> Remove the auto-saved draft from browser storage.</li>
            </ul>
            <p><b>Editing Basics:</b> Use <b>Enter</b> for new item, <b>Shift+Enter</b> for line break, <b>Tab</b> to indent, <b>Shift+Tab</b> to outdent.</p>
        </div>
    </main>

    <script src="worker.js" defer></script> <!-- Load worker script -->
    <script src="script.js"></script>
</body>
</html>