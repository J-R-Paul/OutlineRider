<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bike Editor Pro</title> <!-- Updated title -->
    <link rel="stylesheet" href="style.css">
    <!-- Optional: Add PWA manifest/icons here -->
</head>
<body>
    <header>
        <div class="header-main">
             <h1>Bike Editor Pro</h1>
             <span id="currentFileName" title="Currently open file">No file open</span>
        </div>

        <div class="file-actions">
            <!-- Standard File System Access (Direct Edit) -->
            <div class="action-group" id="directFileAccess" style="display: none;">
                <button id="openDirectButton" title="Open file from device for direct editing (Chrome/Edge)">Open (Direct Edit)</button>
                <button id="saveDirectButton" disabled title="Save changes directly to the opened file (Chrome/Edge)">Save Directly</button>
            </div>

             <!-- OPFS (Safari/iOS App Storage) -->
            <div class="action-group" id="opfsFileAccess" style="display: none;">
                 <button id="manageOpfsButton" title="Open/Manage files saved within this app's private storage (Safari/iOS)">Manage App Files</button>
                 <button id="saveToOpfsButton" disabled title="Save changes to the file in app storage">Save to App Storage</button>
            </div>

            <!-- General Load/Save -->
            <div class="action-group">
                <label for="fileInput" class="file-input-label" title="Load a copy of a file from your device">
                    Load Copy
                    <input type="file" id="fileInput"
                           accept=".bike,.html,application/xhtml+xml,text/xml,application/xml"
                           aria-label="Load Bike File (Creates Copy)">
                </label>
                 <button id="saveAsButton" title="Download the current content as a .bike file">Save As / Download</button>
                 <button id="clearLocalButton" title="Clear the temporary draft saved in browser storage">Clear Temp Draft</button>
            </div>
        </div>
    </header>

    <div id="toolbar">
        <!-- Formatting Buttons -->
        <button class="format-button" data-command="bold" title="Bold (Ctrl+B)"><b>B</b></button>
        <button class="format-button" data-command="italic" title="Italic (Ctrl+I)"><i>I</i></button>
        <button class="format-button" data-command="code" title="Code">{}</button>
        <button class="format-button" data-command="highlight" title="Highlight">H</button>
        <button id="linkButton" title="Create Link (Ctrl+K)">Link</button>
        <hr>
        <!-- Item Type Buttons -->
        <button class="type-button" data-type="heading" title="Heading">H</button>
        <button class="type-button" data-type="note" title="Note">N</button>
        <button class="type-button" data-type="task" title="Task">T</button>
        <button class="type-button" data-type="ordered" title="Ordered List Item">1.</button>
        <button class="type-button" data-type="unordered" title="Unordered List Item">•</button>
        <button class="type-button" data-type="hr" title="Horizontal Rule">—</button>
        <button class="type-button" data-type="" title="Plain Text">P</button> <!-- Empty data-type for default -->
        <hr>
        <!-- Outline Operation Buttons -->
        <button id="indentButton" title="Indent (Tab)">→</button>
        <button id="outdentButton" title="Outdent (Shift+Tab)">←</button>
        <button id="moveUpButton" title="Move Up (Alt+Shift+Up)">↑</button>
        <button id="moveDownButton" title="Move Down (Alt+Shift+Down)">↓</button>
        <button id="deleteButton" title="Delete Item (Del/Backspace on empty)">✕</button>
    </div>

    <main id="outlineContainer" tabindex="0">
        <div id="initialMessage">
            <p>Welcome to Bike Editor Pro!</p>
            <p>Choose how to start:</p>
            <ul>
                <li id="directInfo" style="display: none;"><b>Open (Direct Edit):</b> Edit files directly on your device (Chrome/Edge recommended).</li>
                <li id="opfsInfo" style="display: none;"><b>Manage App Files:</b> Use private app storage, ideal for Safari/iOS persistence.</li>
                <li><b>Load Copy:</b> Open a temporary copy from your device (use 'Save As' to keep changes).</li>
            </ul>
             <p><b>Editing:</b> Enter=New Item, Shift+Enter=Line Break, Tab=Indent, Shift+Tab=Outdent.</p>
             <p>Click task checkboxes <span class="task-example">☐</span> to mark done.</p>
        </div>
    </main>

    <!-- Worker should be loaded before main script if possible, using defer helps -->
    <script src="worker.js" defer></script>
    <script src="script.js"></script>
</body>
</html>